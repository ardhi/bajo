<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>class/print.js - Bajo Framework</title>
    
    
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://bajo.app" target="_blank" class="menu-item" >Project Website</a></h2><h2><a href="https://github.com/ardhi/bajo" target="_blank" class="menu-item" >Github</a></h2><h3 class="collapsed_header">Classes</h3><ul class="collapse_top"><li><a href="App.html">App</a><ul class='methods'><li data-type='method' style='display: none;'><a href="App.html#addPlugin">addPlugin</a></li><li data-type='method' style='display: none;'><a href="App.html#boot">boot</a></li><li data-type='method' style='display: none;'><a href="App.html#dump">dump</a></li></ul></li><li><a href="BajoCore.html">BajoCore</a><ul class='methods'><li data-type='method' style='display: none;'><a href="BajoCore.html#breakNsPath">breakNsPath</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#buildCollections">buildCollections</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#callHandler">callHandler</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#eachPlugins">eachPlugins</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#findDeep">findDeep</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#format">format</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#formatByType">formatByType</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#freeze">freeze</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#generateId">generateId</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#getGlobalModuleDir">getGlobalModuleDir</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#getMethod">getMethod</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#getModuleDir">getModuleDir</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#getPlugin">getPlugin</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#getPluginDataDir">getPluginDataDir</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#getPluginFile">getPluginFile</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#getUnitFormat">getUnitFormat</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#importModule">importModule</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#importPkg">importPkg</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#isEmptyDir">isEmptyDir</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#isLogInRange">isLogInRange</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#isValidApp">isValidApp</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#isValidPlugin">isValidPlugin</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#numUnit">numUnit</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#parseDt">parseDt</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#parseDur">parseDur</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#parseObject">parseObject</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#readConfig">readConfig</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#readJson">readJson</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#resolvePath">resolvePath</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#runHook">runHook</a></li><li data-type='method' style='display: none;'><a href="BajoCore.html#saveAsDownload">saveAsDownload</a></li></ul></li><li><a href="BajoError.html">BajoError</a><ul class='methods'><li data-type='method' style='display: none;'><a href="BajoError.html#fatal">fatal</a></li><li data-type='method' style='display: none;'><a href="BajoError.html#formatErrorDetails">formatErrorDetails</a></li><li data-type='method' style='display: none;'><a href="BajoError.html#write">write</a></li></ul></li><li><a href="BajoPlugin.html">BajoPlugin</a><ul class='methods'><li data-type='method' style='display: none;'><a href="BajoPlugin.html#exit">exit</a></li><li data-type='method' style='display: none;'><a href="BajoPlugin.html#init">init</a></li><li data-type='method' style='display: none;'><a href="BajoPlugin.html#loadConfig">loadConfig</a></li><li data-type='method' style='display: none;'><a href="BajoPlugin.html#start">start</a></li><li data-type='method' style='display: none;'><a href="BajoPlugin.html#stop">stop</a></li></ul></li><li><a href="Log.html">Log</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Log.html#child">child</a></li><li data-type='method' style='display: none;'><a href="Log.html#debug">debug</a></li><li data-type='method' style='display: none;'><a href="Log.html#error">error</a></li><li data-type='method' style='display: none;'><a href="Log.html#fatal">fatal</a></li><li data-type='method' style='display: none;'><a href="Log.html#formatMsg">formatMsg</a></li><li data-type='method' style='display: none;'><a href="Log.html#info">info</a></li><li data-type='method' style='display: none;'><a href="Log.html#init">init</a></li><li data-type='method' style='display: none;'><a href="Log.html#isExtLogger">isExtLogger</a></li><li data-type='method' style='display: none;'><a href="Log.html#isIgnored">isIgnored</a></li><li data-type='method' style='display: none;'><a href="Log.html#trace">trace</a></li><li data-type='method' style='display: none;'><a href="Log.html#warn">warn</a></li><li data-type='method' style='display: none;'><a href="Log.html#write">write</a></li></ul></li><li><a href="Plugin.html">Plugin</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Plugin.html#error">error</a></li><li data-type='method' style='display: none;'><a href="Plugin.html#fatal">fatal</a></li><li data-type='method' style='display: none;'><a href="Plugin.html#getConfig">getConfig</a></li><li data-type='method' style='display: none;'><a href="Plugin.html#initLog">initLog</a></li><li data-type='method' style='display: none;'><a href="Plugin.html#initPrint">initPrint</a></li></ul></li><li><a href="Print.html">Print</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Print.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="Print.html#fail">fail</a></li><li data-type='method' style='display: none;'><a href="Print.html#fatal">fatal</a></li><li data-type='method' style='display: none;'><a href="Print.html#getElapsed">getElapsed</a></li><li data-type='method' style='display: none;'><a href="Print.html#info">info</a></li><li data-type='method' style='display: none;'><a href="Print.html#init">init</a></li><li data-type='method' style='display: none;'><a href="Print.html#render">render</a></li><li data-type='method' style='display: none;'><a href="Print.html#setOpts">setOpts</a></li><li data-type='method' style='display: none;'><a href="Print.html#setText">setText</a></li><li data-type='method' style='display: none;'><a href="Print.html#spinner">spinner</a></li><li data-type='method' style='display: none;'><a href="Print.html#start">start</a></li><li data-type='method' style='display: none;'><a href="Print.html#stop">stop</a></li><li data-type='method' style='display: none;'><a href="Print.html#succeed">succeed</a></li><li data-type='method' style='display: none;'><a href="Print.html#warn">warn</a></li><li data-type='method' style='display: none;'><a href="Print.html#write">write</a></li></ul></li></ul><h3 class="collapsed_header">Modules</h3><ul class="collapse_top"><li><a href="module-class_helper_bajo-core.html">class/helper/bajo-core</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-class_helper_bajo-core.html#.bootPlugins">bootPlugins</a></li><li data-type='method' style='display: none;'><a href="module-class_helper_bajo-core.html#.buildBaseConfig">buildBaseConfig</a></li><li data-type='method' style='display: none;'><a href="module-class_helper_bajo-core.html#.buildExtConfig">buildExtConfig</a></li><li data-type='method' style='display: none;'><a href="module-class_helper_bajo-core.html#.buildPlugins">buildPlugins</a></li></ul></li><li><a href="module-class_helper_bajo-plugin.html">class/helper/bajo-plugin</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-class_helper_bajo-plugin.html#.attachMethods">attachMethods</a></li><li data-type='method' style='display: none;'><a href="module-class_helper_bajo-plugin.html#.buildConfigs">buildConfigs</a></li><li data-type='method' style='display: none;'><a href="module-class_helper_bajo-plugin.html#.checkDependencies">checkDependencies</a></li><li data-type='method' style='display: none;'><a href="module-class_helper_bajo-plugin.html#.checkNameAliases">checkNameAliases</a></li><li data-type='method' style='display: none;'><a href="module-class_helper_bajo-plugin.html#.collectHooks">collectHooks</a></li><li data-type='method' style='display: none;'><a href="module-class_helper_bajo-plugin.html#.run">run</a></li></ul></li><li><a href="module-lib_create-method.html">lib/create-method</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-lib_create-method.html#~createMethod">createMethod</a></li></ul></li><li><a href="module-lib_formats.html">lib/formats</a></li><li><a href="module-lib_log-levels.html">lib/log-levels</a></li><li><a href="module-lib_shim.html">lib/shim</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-lib_shim.html#~shim">shim</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
    
</nav>

<div id="main">
    
    <h1 class="page-title">class/print.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import ora from 'ora'
import lodash from 'lodash'
import fs from 'fs-extra'
import Sprintf from 'sprintf-js'
const { sprintf } = Sprintf
let unknownLangWarning = false

const { isString, last, isPlainObject, get, without, reverse, map } = lodash

/**
 * Print engine. Use sprintf to interpolate pattern and variable. Support
 * many methods to display things on screen including {@link https://github.com/sindresorhus/ora|ora} based spinner.
 *
 * It also serve as the foundation of Bajo's I18n lightweight system.
 *
 * @class
 */
class Print {
  /**
   * Class constructor
   *
   * @param {Object} plugin - Plugin instance
   * @param {Object} [opts={}] - Options to pass to {@link https://github.com/sindresorhus/ora|ora}
   */
  constructor (plugin, opts = {}) {
    this.opts = opts
    this.plugin = plugin
    this.startTime = this.plugin.app.bajo.lib.dayjs()
    this.setOpts()
    this.ora = ora(this.opts)
    this.intl = {}
  }

  /**
   * Initialize print engine and read plugin's translation files
   *
   * @method
   */
  init = () => {
    for (const l of this.plugin.app.bajo.config.intl.supported) {
      this.intl[l] = {}
      const path = `${this.plugin.dir.pkg}/extend/bajo/intl/${l}.json`
      if (!fs.existsSync(path)) continue
      const trans = fs.readFileSync(path, 'utf8')
      try {
        this.intl[l] = JSON.parse(trans)
      } catch (err) {}
    }
  }

  /**
   * Interpolate and translate text according to the chosen language
   *
   * @method
   * @param {string} text - Text pattern to translate. See {@link https://github.com/alexei/sprintf.js|sprintf} for all supported token &amp; format
   * @param {...any} [args] - Variables to interpolate with text pattern above. If the last argument is an object, it will be use to override default translation option. Example: to force language to 'id', pass the last argument as "{ lang: 'id' }"
   * @returns {string} Interpolated &amp; translated text
   */
  write = (text, ...args) => {
    const opts = last(args)
    let lang = this.plugin.app.bajo.config.lang
    if (isPlainObject(opts)) {
      args.pop()
      if (opts.lang) lang = opts.lang
    }
    const { fallback, supported } = this.plugin.app.bajo.config.intl
    if (!unknownLangWarning &amp;&amp; !supported.includes(lang)) {
      unknownLangWarning = true
      this.plugin.app.bajo.log.warn('unsupportedLangFallbackTo%s', fallback)
    }
    const plugins = reverse(without([...this.plugin.app.bajo.pluginNames], this.plugin.name))
    plugins.unshift(this.plugin.name)
    plugins.push('bajo')

    let trans
    for (const p of plugins) {
      const root = get(this, `plugin.app.${p}.print.intl.${lang}`, {})
      trans = get(root, text)
      if (trans) break
    }
    if (!trans) {
      for (const p of plugins) {
        const root = get(this, `plugin.app.${p}.print.intl.${fallback}`, {})
        trans = get(root, text)
        if (trans) break
      }
    }
    if (!trans) trans = text
    const params = map(args, a => {
      if (!isString(a)) return a
      return a
    })
    return sprintf(trans, ...params)
  }

  /**
   * Set spinner options
   *
   * @method
   * @param {any[]} [args=[]] - Array of options. If the last argument is an object, it will be used to override ora options
   */
  setOpts = (args = []) => {
    const config = this.plugin.app.bajo.config
    let opts = {}
    if (isPlainObject(args.slice(-1)[0])) opts = args.pop()
    this.opts.isSilent = !!(config.silent || this.opts.isSilent)
    this.opts = this.plugin.lib.aneka.defaultsDeep(opts, this.opts)
  }

  /**
   * Set spinner text
   *
   * @method
   * @param {string} text - Text to use
   * @param {...any} [args] - Any variable to interpolate text. If the last argument is an object, it will be used to override ora options
   * @returns {Object} Return itself, usefull to chain methods
   */
  setText = (text, ...args) => {
    text = this.write(text, ...args)
    this.setOpts(args)
    const prefixes = []
    const texts = []
    if (this.opts.showDatetime) prefixes.push('[' + this.plugin.app.bajo.lib.dayjs().toISOString() + ']')
    if (this.opts.showCounter) texts.push('[' + this.getElapsed() + ']')
    if (prefixes.length > 0) this.ora.prefixText = this.ora.prefixText + prefixes.join(' ')
    if (texts.length > 0) text = texts.join(' ') + ' ' + text
    this.ora.text = text
    return this
  }

  /**
   * Get elapsed time since print instance is created
   *
   * @method
   * @param {string} [unit=hms] - Unit's time. Put 'hms' (default) to get hour, minute, second format or of any format supported by {@link https://day.js.org/docs/en/display/difference|dayjs}
   * @returns {string} Elapsed time since start
   */
  getElapsed = (unit = 'hms') => {
    const u = unit === 'hms' ? 'second' : unit
    const elapsed = this.plugin.lib.dayjs().diff(this.startTime, u)
    return unit === 'hms' ? this.plugin.lib.aneka.secToHms(elapsed) : elapsed
  }

  /**
   * Start the spinner
   *
   * @method
   * @param {string} text - Text to use
   * @param {...any} [args] - Any variable to interpolate text. If the last argument is an object, it will be used to override ora options
   * @returns {Object} Return itself, usefull to chain methods
   */
  start = (text, ...args) => {
    this.setOpts(args)
    this.setText(text, ...args)
    this.ora.start()
    return this
  }

  /**
   * Stop the spinner
   *
   * @method
   * @returns {Object} Return itself, usefull to chain methods
   */
  stop = () => {
    this.ora.stop()
    return this
  }

  /**
   * Print success message, prefixed with a check icon
   *
   * @method
   * @param {string} text - Text to use
   * @param {...any} [args] - Any variable to interpolate text. If the last argument is an object, it will be used to override ora options
   * @returns {Object} Return itself, usefull to chain methods
   */
  succeed = (text, ...args) => {
    this.setText(text, ...args)
    this.ora.succeed()
    return this
  }

  /**
   * Print failed message, prefixed with a cross icon
   *
   * @method
   * @param {string} text - Text to use
   * @param {...any} [args] - Any variable to interpolate text. If the last argument is an object, it will be used to override ora options
   * @returns {Object} Return itself, usefull to chain methods
   */
  fail = (text, ...args) => {
    this.setText(text, ...args)
    this.ora.fail()
    return this
  }

  /**
   * Print warning message, prefixed with a warn icon
   *
   * @method
   * @param {string} text - Text to use
   * @param {...any} [args] - Any variable to interpolate text. If the last argument is an object, it will be used to override ora options
   * @returns {Object} Return itself, usefull to chain methods
   */
  warn = (text, ...args) => {
    this.setText(text, ...args)
    this.ora.warn()
    return this
  }

  /**
   * Print failed message, prefixed with an info icon
   *
   * @method
   * @param {string} text - Text to use
   * @param {...any} [args] - Any variable to interpolate text. If the last argument is an object, it will be used to override ora options
   * @returns {Object} Return itself, usefull to chain methods
   */
  info = (text, ...args) => {
    this.setText(text, ...args)
    this.ora.info()
    return this
  }

  /**
   * Clear spinner text
   *
   * @method
   * @returns {Object} Return itself, usefull to chain methods
   */
  clear = () => {
    this.ora.clear()
    return this
  }

  /**
   * Force render spinner
   *
   * @method
   * @returns {Object} Return itself, usefull to chain methods
   */
  render = () => {
    this.ora.render()
    return this
  }

  /**
   * Print failed message, prefixed with a cross icon and terminate the app process
   *
   * @method
   * @param {string} text - Text to use
   * @param {...any} [args] - Any variable to interpolate text. If the last argument is an object, it will be used to override ora options
   */
  fatal = (text, ...args) => {
    this.setText(text, ...args)
    this.ora.fail()
    process.kill(process.pid, 'SIGINT')
  }

  /**
   * Create a new spinner
   *
   * @method
   * @returns {Object} Return new instance
   */
  spinner = () => {
    return new Print(this.plugin)
  }
}

export default Print
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Sat Aug 23 2025 10:40:51 GMT+0700 (Western Indonesia Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
